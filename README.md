# Fluency Rater (Supabase Version)

This is a full-stack application that allows users to rate fluency, built with a React/Vite frontend and a Supabase backend.

## Table of Contents

- [Features](#features)
- [Tech Stack](#tech-stack)
- [Getting Started](#getting-started)
  - [Prerequisites](#prerequisites)
  - [Supabase Setup](#supabase-setup)
  - [Installation](#installation)
- [Usage](#usage)
- [Contributing](#contributing)
- [License](#license)

## Features

- User Authentication (Sign up, Sign in) with Supabase Auth.
- Users can submit fluency ratings across three dimensions: naturalness, confidence, and eye contact.
- Users can view their past ratings.
- Admin dashboard to view analytics and all user ratings.

## Tech Stack

- **Frontend:**
  - [React](https://reactjs.org/)
  - [Vite](https://vitejs.dev/)
  - [Tailwind CSS](https://tailwindcss.com/)
  - [shadcn/ui](https://ui.shadcn.com/)
  - [TanStack Query](https://tanstack.com/query/latest)
- **Backend:**
  - [Supabase](https://supabase.io/) (Database, Auth, Storage)

## Getting Started

### Prerequisites

- [Node.js](https://nodejs.org/) (v18 or higher)
- [npm](https://www.npmjs.com/)
- A [Supabase](https://supabase.io/) account.

### Supabase Setup

1.  **Create a new project** on Supabase.
2.  **Database Schema:** Use the SQL Editor in Supabase to create the `profiles` and `ratings` tables.

    ```sql
    -- Create profiles table to store public user data
    create table profiles (
      id uuid references auth.users not null primary key,
      updated_at timestamp with time zone,
      first_name text,
      last_name text,
      is_admin boolean default false
    );

    -- Create ratings table
    create table ratings (
      id bigint generated by default as identity primary key,
      user_id uuid references auth.users not null,
      naturalness integer not null check (naturalness between 1 and 10),
      confidence integer not null check (confidence between 1 and 10),
      eye_contact integer not null check (eye_contact between 1 and 10),
      comment text,
      created_at timestamp with time zone default timezone('utc'::text, now()) not null
    );

    -- (Optional but Recommended)
    -- SQL trigger to auto-create a profiles row on new user signup
    create function public.handle_new_user()
    returns trigger as $$
    begin
      insert into public.profiles (id)
      values (new.id);
      return new;
    end;
    $$ language plpgsql security definer;

    create trigger on_auth_user_created
      after insert on auth.users
      for each row execute procedure public.handle_new_user();

    -- (Optional but Recommended) Row Level Security
    alter table profiles enable row level security;
    alter table ratings enable row level security;

    create policy "Users can see all profiles." on profiles for select using (true);
    create policy "Users can insert their own profile." on profiles for insert with check (auth.uid() = id);
    create policy "Users can update their own profile." on profiles for update using (auth.uid() = id);

    create policy "Users can see their own ratings." on ratings for select using (auth.uid() = user_id);
    create policy "Admins can see all ratings." on ratings for select using ( (select is_admin from profiles where id = auth.uid()) );
    create policy "Users can insert their own ratings." on ratings for insert with check (auth.uid() = user_id);
    ```

### Installation

1.  **Clone the repository.**
2.  **Install dependencies:** `npm install`
3.  **Set up environment variables:**
    Create a `.env` file in the `client` directory and add your Supabase project URL and Anon key.

    ```
    VITE_SUPABASE_URL="your_supabase_url"
    VITE_SUPABASE_ANON_KEY="your_supabase_anon_key"
    ```

4.  **Start the development server:** `npm run dev`

## Usage

Navigate to the local URL provided by Vite. You can sign up, sign in, and start submitting ratings. To grant admin access, you must manually set the `is_admin` flag to `true` for a user in your Supabase `profiles` table.

## Contributing

Contributions are welcome! Please feel free to open an issue or submit a pull request.

1.  Fork the Project
2.  Create your Feature Branch (`git checkout -b feature/AmazingFeature`)
3.  Commit your Changes (`git commit -m 'Add some AmazingFeature'`)
4.  Push to the Branch (`git push origin feature/AmazingFeature`)
5.  Open a Pull Request

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.
